<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Distributed Worker Launcher Framework ‚Ä¢ crew</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A Distributed Worker Launcher Framework">
<meta property="og:description" content="In computationally demanding analysis projects,
  statisticians and data scientists asynchronously
  deploy long-running tasks to distributed systems,
  ranging from traditional clusters to cloud services.
  The NNG-powered mirai R package by Gao (2023)
  &lt;https://CRAN.R-project.org/package=mirai&gt; is a sleek
  and sophisticated scheduler that
  efficiently processes these intense workloads.
  The crew package extends mirai with a unifying
  interface for third-party worker launchers.
  Inspiration also comes from packages.
  future by Bengtsson (2021) &lt;doi:10.32614/RJ-2021-048&gt;,
  rrq by FitzJohn and Ashton (2023) &lt;https://github.com/mrc-ide/rrq&gt;,
  clustermq by Schubert (2019) &lt;doi:10.1093/bioinformatics/btz284&gt;),
  and batchtools by Lang, Bischel, and Surmann (2017)
  &lt;doi:10.21105/joss.00135&gt;.">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">crew</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/groups.html">Controller groups</a>
    </li>
    <li>
      <a href="articles/plugins.html">Launcher plugins</a>
    </li>
    <li>
      <a href="articles/shiny.html">Asynchronous Shiny apps</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wlandau/crew/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="crew-a-distributed-worker-launcher-framework-">crew: a distributed worker launcher framework <img src="reference/figures/logo-readme.png" align="right" height="139"><a class="anchor" aria-label="anchor" href="#crew-a-distributed-worker-launcher-framework-"></a>
</h1></div>
<p><a href="https://CRAN.R-project.org/package=crew" class="external-link"><img src="https://www.r-pkg.org/badges/version/crew" alt="CRAN"></a> <a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="status"></a> <a href="https://github.com/wlandau/crew/actions?query=workflow%3Acheck" class="external-link"><img src="https://github.com/wlandau/crew/workflows/check/badge.svg" alt="check"></a> <a href="https://app.codecov.io/gh/wlandau/crew" class="external-link"><img src="https://codecov.io/gh/wlandau/crew/branch/main/graph/badge.svg?token=3T5DlLwUVl" alt="codecov"></a> <a href="https://github.com/wlandau/crew/actions?query=workflow%3Alint" class="external-link"><img src="https://github.com/wlandau/crew/workflows/lint/badge.svg" alt="lint"></a></p>
<p>In computationally demanding analysis projects, statisticians and data scientists asynchronously deploy long-running tasks to distributed systems, ranging from traditional clusters to cloud services. The <a href="https://nng.nanomsg.org" class="external-link">NNG</a>-powered <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> R package is a sleek and sophisticated scheduler that efficiently processes these intense workloads. The <code>crew</code> package extends <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> with a unifying interface for third-party worker launchers. Inspiration also comes from packages <a href="https://future.futureverse.org/" class="external-link"><code>future</code></a>, <a href="https://mrc-ide.github.io/rrq/" class="external-link"><code>rrq</code></a>, <a href="https://mschubert.github.io/clustermq/" class="external-link"><code>clustermq</code></a>, and <a href="https://mllg.github.io/batchtools/" class="external-link"><code>batchtools</code></a>.</p>
</div>
<div class="section level1">
<h1 id="id_-request-to-the-community-">üì£üì£üì£ Request to the community üì£üì£üì£<a class="anchor" aria-label="anchor" href="#id_-request-to-the-community-"></a>
</h1>
<p><span style="color: blue"><strong>The <a href="https://wlandau.github.io/crew/articles/plugins.html" class="external-link">launcher plugin framework</a> aims to extend <code>crew</code> to modern platforms and services like <a href="https://aws.amazon.com/batch/" class="external-link">AWS Batch</a>, <a href="https://cloud.google.com/run/" class="external-link">Google Cloud Run</a>, <a href="https://kubernetes.io/" class="external-link">Kubernetes</a>, and beyond. At the time of writing, plugins for cloud computing do not yet exist. So if you know how to use these services and connect them with R, please consider contributing a package with plugins of your own. The tutorial at <a href="https://wlandau.github.io/crew/articles/plugins.html" class="external-link uri">https://wlandau.github.io/crew/articles/plugins.html</a> explains how. The maintainer of <code>crew</code> would love to work with you!</strong></span></p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<table class="table">
<colgroup>
<col width="13%">
<col width="12%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>Source</th>
<th>Command</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Release</td>
<td>CRAN</td>
<td><code>install.packages("crew")</code></td>
</tr>
<tr class="even">
<td>Development</td>
<td>GitHub</td>
<td><code>remotes::install_github("wlandau/crew")</code></td>
</tr>
<tr class="odd">
<td>Development</td>
<td>R-universe</td>
<td><code>install.packages("crew", repos = "https://wlandau.r-universe.dev")</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level1">
<h1 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h1>
<p>The documentation website at <a href="https://wlandau.github.io/crew/" class="external-link uri">https://wlandau.github.io/crew/</a> includes a <a href="https://wlandau.github.io/crew/reference/index.html" class="external-link">function reference</a> and tutorial vignettes.</p>
</div>
<div class="section level1">
<h1 id="concepts">Concepts<a class="anchor" aria-label="anchor" href="#concepts"></a>
</h1>
<p>A <em>task</em> is a piece of R code, such as an expression or a function call. A <em>worker</em> is a <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/interactive.html" class="external-link">non-interactive</a> R process that runs one or more tasks. When tasks run on workers, the local R session is free and responsive, and work gets done faster. For example, <a href="https://wlandau.github.io/crew/articles/shiny.html" class="external-link">this vignette</a> shows how <code>crew</code> and <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> work together to speed up <a href="https://rstudio.github.io/shiny/" class="external-link">Shiny</a> apps.</p>
</div>
<div class="section level1">
<h1 id="plugins">Plugins<a class="anchor" aria-label="anchor" href="#plugins"></a>
</h1>
<p>A worker runs on your local computer, a SLURM cluster, AWS Batch, or any number of other platforms. As long as the worker connects to your R session over the local network, <code>crew</code> can use <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> to send it tasks. You can write your own <a href="https://wlandau.github.io/crew/articles/plugins.html" class="external-link">launcher plugin</a> to teach <code>crew</code> how to use your platform. The <a href="https://wlandau.github.io/crew.cluster/" class="external-link"><code>crew.cluster</code></a> package supports plugins for SLURM, Sun Grid Engine (SGE), LSF, and PBS/TORQUE.</p>
</div>
<div class="section level1">
<h1 id="tasks">Tasks<a class="anchor" aria-label="anchor" href="#tasks"></a>
</h1>
<p>First, create a controller object to manage tasks and workers.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wlandau.github.io/crew/" class="external-link">crew</a></span><span class="op">)</span></span>
<span><span class="va">controller</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crew_controller_local.html">crew_controller_local</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"example"</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  seconds_idle <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, start the controller to create the <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> client. Later, when you are done with the controller, call <code>controller$terminate()</code> to clean up the workers and dispatcher.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Use <code>push()</code> to submit a new task and <code>pop()</code> to return a completed task.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">push</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"get pid"</span>, command <span class="op">=</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://ps.r-lib.org/reference/ps_pid.html" class="external-link">ps_pid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Behind the scenes, <code>push()</code> and <code>pop()</code> also launch workers to run the tasks. This process is expensive, so <code>crew</code> uses <a href="https://css-tricks.com/debouncing-throttling-explained-examples/" class="external-link">throttling</a>. That means not every call to <code>push()</code> or <code>pop()</code> launches any workers. To ensure enough workers get launched, keep calling <code>pop()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">pop</span><span class="op">(</span><span class="op">)</span> <span class="co"># No workers started yet and the task is not done.</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="va">controller</span><span class="op">$</span><span class="fu">pop</span><span class="op">(</span><span class="op">)</span> <span class="co"># Worker started, task complete.</span></span>
<span><span class="va">task</span></span>
<span><span class="co">#&gt; # A tibble: 1 √ó 11</span></span>
<span><span class="co">#&gt;   name    command result seconds   seed error trace warnings launcher worker</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;list&gt;   &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 get pid NA      &lt;int&gt;        0 1.78e9 NA    NA    NA       372d50b‚Ä¶      1</span></span>
<span><span class="co">#&gt; # ‚Ñπ 1 more variable: instance &lt;chr&gt;</span></span></code></pre></div>
<p>Alternatively, <code>wait()</code> is a loop that repeatedly checks tasks and launches workers until all tasks complete.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p>The return value of the task is in the <code>result</code> column.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span><span class="op">$</span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># return value of the task</span></span>
<span><span class="co">#&gt; [1] 69631</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="summaries">Summaries<a class="anchor" aria-label="anchor" href="#summaries"></a>
</h1>
<p>The controller summary shows how many tasks each worker ran, how many total seconds it spent running tasks, and how many tasks threw warnings and errors.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 √ó 6</span></span>
<span><span class="co">#&gt;   controller worker tasks seconds errors warnings</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 example         1     1   0.001      0        0</span></span>
<span><span class="co">#&gt; 2 example         2     0       0      0        0</span></span></code></pre></div>
<p>The schedule summary counts ‚Äúpushed‚Äù tasks which may not be complete and ‚Äúcollected‚Äù tasks which <code>pop()</code> can return.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="va">schedule</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 √ó 2</span></span>
<span><span class="co">#&gt;   pushed collected</span></span>
<span><span class="co">#&gt;    &lt;int&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1      0         0</span></span></code></pre></div>
<p>The launcher summary counts the number of times each worker was launched, and it shows the total number of assigned and completed tasks from all past terminated instances of each worker.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="va">launcher</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 √ó 4</span></span>
<span><span class="co">#&gt;   worker launches assigned complete</span></span>
<span><span class="co">#&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1      1        1        0        0</span></span>
<span><span class="co">#&gt; 2      2        0        0        0</span></span></code></pre></div>
<p>Finally, the client summary shows up-to-date worker status from <code><a href="https://shikokuchuo.net/mirai/reference/daemons.html" class="external-link">mirai::daemons()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="va">client</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 √ó 6</span></span>
<span><span class="co">#&gt;   worker online instances assigned complete socket                          </span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;lgl&gt;      &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;                           </span></span>
<span><span class="co">#&gt; 1      1 FALSE          1        1        1 ws://10.0.0.32:58685/1/15e07250‚Ä¶</span></span>
<span><span class="co">#&gt; 2      2 FALSE          0        0        0 ws://10.0.0.32:58685/2/cb45b3d4‚Ä¶</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="termination">Termination<a class="anchor" aria-label="anchor" href="#termination"></a>
</h1>
<p>Call <code>terminate()</code> on the controller after you finish using it. <code>terminate()</code> tries to close the the <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> dispatcher and any workers that may still be running. It is important to free up these resources.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">terminate</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="scale">Scale<a class="anchor" aria-label="anchor" href="#scale"></a>
</h1>
<p>As explained above, <code>push()</code>, <code>pop()</code>, and <code>wait()</code> launch new workers to run tasks. The number of new workers depends on the number of tasks at the time. In addition, workers can shut themselves down as work completes. In other words, <code>crew</code> automatically raises and lowers the number of workers in response to fluctuations in the task workload.</p>
<p>The most useful arguments for down-scaling, in order of importance, are:</p>
<ol style="list-style-type: decimal">
<li>
<code>seconds_idle</code>: shut down a worker if it spends too long waiting for a task.</li>
<li>
<code>tasks_max</code>: shut down a worker after it completes a certain number of tasks.</li>
<li>
<code>seconds_wall</code>: soft wall time of a worker.</li>
</ol>
<p>Please tune these these arguments to achieve the desired balance for auto-scaling. The two extremes of auto-scaling are <a href="https://mschubert.github.io/clustermq/" class="external-link"><code>clustermq</code></a>-like <em>persistent workers</em> and <a href="https://future.futureverse.org/" class="external-link"><code>future</code></a>-like <em>transient workers</em>, and each is problematic in its own way.</p>
<ol style="list-style-type: decimal">
<li>
<em>Persistent workers</em>: a persistent worker launches once, typically runs many tasks, and stays running for the entire lifetime of the controller. Persistent workers minimize overhead and quickly complete large numbers of short tasks. However, they risk spending too much time in an idle state if there are no tasks to run. Excessive idling wastes resources, which could impact your colleagues on a shared cluster or drive up costs on Amazon Web Services.</li>
<li>
<em>Transient workers</em>: a transient worker terminates as soon as it completes a single task. Each subsequent task requires a new transient worker to run it. Transient workers avoid excessive idling, but frequent worker launches cause significant overhead and slows down the computation as a whole.</li>
</ol>
</div>
<div class="section level1">
<h1 id="risks">Risks<a class="anchor" aria-label="anchor" href="#risks"></a>
</h1>
<p>The <code>crew</code> package has unavoidable risk. It is your responsibility as the user to safely use <code>crew</code>. Please read the final clause of the <a href="https://wlandau.github.io/crew/LICENSE.html" class="external-link">software license</a>.</p>
<div class="section level2">
<h2 id="security">Security<a class="anchor" aria-label="anchor" href="#security"></a>
</h2>
<p><code>crew</code> currently uses unencrypted TCP connections for transactions with workers inside a trusted local network. In a compromised network, an attacker can potentially access and exploit sensitive resources. It is your responsibility to assess the sensitivity and vulnerabilities of your computing environment and make sure your network is secure.</p>
</div>
<div class="section level2">
<h2 id="ports">Ports<a class="anchor" aria-label="anchor" href="#ports"></a>
</h2>
<p><code>crew</code> uses one TCP port per controller. TCP ports range from 0 to 65535, and only around 16000 of these ports are considered ephemeral or dynamic, so please be careful not to run too many controllers simultaneously if you are running R on a machine you share with other people (such as the login node of a shared cluster). If you are running a <a href="https://wlandau.github.io/crew/articles/groups.html" class="external-link">controller group</a> please add only a small number of controllers to the group. The <code>terminate()</code> frees these ports again for other processes to use.</p>
</div>
<div class="section level2">
<h2 id="zombies">Zombies<a class="anchor" aria-label="anchor" href="#zombies"></a>
</h2>
<p>The <code>crew</code> package launches external R processes:</p>
<ol style="list-style-type: decimal">
<li>Worker processes to run tasks, possibly on different computers on the local network, and</li>
<li>A local <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> dispatcher process to schedule the tasks.</li>
</ol>
<p>To the best of its ability, <code>crew</code> tries to only launch the processes it needs, and it relies on <code>mirai</code> to clean up these processes when the work is done. However, sometimes it is still possible that too many workers may run concurrently, and it is still possible that either the workers or the <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> dispatcher may run too long or hang. In large-scale workflows, these accidents can have egregious consequences. Depending on the launcher type, these consequences can range from overburdening your local machine or cluster, to incurring unexpectedly high costs on <a href="https://aws.amazon.com/" class="external-link">Amazon Web Services</a>.</p>
<div class="section level3">
<h3 id="workers">Workers<a class="anchor" aria-label="anchor" href="#workers"></a>
</h3>
<p><code>mirai</code> robustly terminates workers as appropriate, but this safeguard cannot protect against the risk of a worker that gets stuck in a crashed state before it can even start R. To be absolutely sure that workers do not run indefinitely if something goes wrong, please learn how to find and terminate workers on the specific computing platform where they run. And if you are writing a custom launcher plugin, it is recommended (although not strictly required) to write a custom <code>terminate_worker()</code> method.</p>
<p>Workers may run on different computing platforms, depending on the type of launcher you choose. Each type of launcher connects to a different computing platform, and each platform has a different way of terminating workers. For example, the <a href="https://wlandau.github.io/crew/reference/crew_launcher_local.html" class="external-link">local process launcher</a> creates R processes on your local machine, which you can find and terminate with <a href="https://ps.r-lib.org/reference/ps.html" class="external-link"><code>ps::ps()</code></a>/<a href="https://ps.r-lib.org/reference/ps_kill.html" class="external-link"><code>ps::ps_kill()</code></a> or <a href="https://htop.dev/" class="external-link"><code>htop</code></a>. For a SLURM launcher, you need <a href="https://slurm.schedmd.com/squeue.html" class="external-link"><code>squeue</code></a> to find workers and <a href="https://slurm.schedmd.com/scancel.html" class="external-link"><code>scancel</code></a> to terminate them. For an <a href="https://aws.amazon.com/" class="external-link">Amazon Web Services</a> launcher, please use the <a href="https://aws.amazon.com/console/" class="external-link">AWS web console</a> or <a href="https://aws.amazon.com/cloudwatch/" class="external-link">CloudWatch</a>.</p>
</div>
<div class="section level3">
<h3 id="dispatcher">Dispatcher<a class="anchor" aria-label="anchor" href="#dispatcher"></a>
</h3>
<p>The <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> dispatcher is designed to gracefully exit when you call <code>terminate()</code> on the controller object or when you restart your R session. However, if you ever need to shut down the dispatcher manually, you can find the process ID using the controller object, then use <code><a href="https://ps.r-lib.org/reference/ps_kill.html" class="external-link">ps::ps_kill()</a></code> to terminate the process.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="va">client</span><span class="op">$</span><span class="va">dispatcher</span></span>
<span><span class="co">#&gt; [1] 86028</span></span>
<span><span class="va">handle</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://ps.r-lib.org/reference/ps_handle.html" class="external-link">ps_handle</a></span><span class="op">(</span>pid <span class="op">=</span> <span class="fl">86028L</span><span class="op">)</span></span>
<span><span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://ps.r-lib.org/reference/ps_is_running.html" class="external-link">ps_is_running</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://ps.r-lib.org/reference/ps_kill.html" class="external-link">ps_kill</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span>
<span><span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://ps.r-lib.org/reference/ps_is_running.html" class="external-link">ps_is_running</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="similar-work">Similar work<a class="anchor" aria-label="anchor" href="#similar-work"></a>
</h1>
<ul>
<li>
<a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>: a powerful R framework for asynchronous tasks built on <a href="https://nng.nanomsg.org" class="external-link">NNG</a>. The purpose of <code>crew</code> is to extend <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> to different computing platforms for distributed workers.</li>
<li>
<a href="https://mrc-ide.github.io/rrq/" class="external-link"><code>rrq</code></a>: a task queue for R based on <a href="https://redis.io" class="external-link">Redis</a>.</li>
<li>
<a href="http://traitecoevo.github.io/rrqueue/" class="external-link"><code>rrqueue</code></a>: predecessor of <a href="https://mrc-ide.github.io/rrq/" class="external-link"><code>rrq</code></a>.</li>
<li>
<a href="https://mschubert.github.io/clustermq/" class="external-link"><code>clustermq</code></a>: sends R function calls as jobs to computing clusters.</li>
<li>
<a href="https://future.futureverse.org/" class="external-link"><code>future</code></a>: a unified interface for asynchronous evaluation of single tasks and map-reduce calls on a wide variety of backend technologies.</li>
<li>
<a href="https://mllg.github.io/batchtools/" class="external-link"><code>batchtools</code></a>: tools for computation on batch systems.</li>
<li>
<a href="https://docs.ropensci.org/targets/" class="external-link"><code>targets</code></a>: a Make-like pipeline tool for R.</li>
<li>
<a href="https://r-lib.github.io/later/" class="external-link"><code>later</code></a>: delayed evaluation of synchronous tasks.</li>
<li>
<a href="https://rstudio.github.io/promises/" class="external-link"><code>promises</code></a>: minimally-invasive asynchronous programming for a small number of tasks within Shiny apps.</li>
<li>
<a href="https://github.com/r-lib/callr" class="external-link"><code>callr</code></a>: initiates R process from other R processes.</li>
<li>
<a href="https://CRAN.R-project.org/view=HighPerformanceComputing" class="external-link">High-performance computing CRAN task view</a>.</li>
</ul>
</div>
<div class="section level1">
<h1 id="thanks">Thanks<a class="anchor" aria-label="anchor" href="#thanks"></a>
</h1>
<p>The <code>crew</code> package incorporates insightful ideas from the following people.</p>
<ul>
<li>
<a href="https://github.com/shikokuchuo" class="external-link">Charlie Gao</a> created <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> and <a href="https://github.com/shikokuchuo/nanonext" class="external-link"><code>nanonext</code></a> and graciously accommodated the complicated and demanding feature requests that made <code>crew</code> possible.</li>
<li>
<a href="https://github.com/richfitz" class="external-link">Rich FitzJohn</a> and <a href="https://github.com/r-ash" class="external-link">Robert Ashton</a> developed <a href="https://mrc-ide.github.io/rrq//" class="external-link"><code>rrq</code></a>.</li>
<li>
<a href="https://github.com/gaborcsardi/" class="external-link">G√°bor Cs√°rdi</a> developed <a href="https://github.com/r-lib/callr" class="external-link"><code>callr</code></a> and wrote an <a href="https://www.tidyverse.org/blog/2019/09/callr-task-q/" class="external-link">edifying blog post on implementing task queues</a>.</li>
<li>
<a href="https://github.com/krlmlr/" class="external-link">Kirill M√ºller</a> created the <a href="https://github.com/wlandau/workers" class="external-link"><code>workers</code></a> prototype, an initial effort that led directly to the current implementation of <code>crew</code>. <code>crew</code> would not exist without Kirill‚Äôs insights about orchestration models for R processes.</li>
<li>
<a href="https://github.com/HenrikBengtsson/" class="external-link">Henrik Bengtsson</a>. Henrik‚Äôs <a href="https://github.com/HenrikBengtsson/future/" class="external-link"><code>future</code></a> package ecosystem demonstrates the incredible power of a consistent R interface on top of a varying collection of high-performance computing technologies.</li>
<li>
<a href="https://github.com/mschubert/" class="external-link">Michael Schubert</a>. Michael‚Äôs <a href="https://mschubert.github.io/clustermq/" class="external-link"><code>clustermq</code></a> package supports efficient high-performance computing on traditional clusters, and it demonstrates the value of a central <code>R6</code> object to manage an entire collection of persistent workers.</li>
<li>
<a href="https://github.com/davidkretch" class="external-link">David Kretch</a>. The <a href="https://github.com/paws-r/paws" class="external-link"><code>paws</code></a> R package is a powerful interface to Amazon Web Services, and the documentation clearly communicates the capabilities and limitations of AWS to R users.</li>
<li>
<a href="https://github.com/adambanker" class="external-link">Adam Banker</a>, co-authored <a href="https://github.com/paws-r/paws" class="external-link"><code>paws</code></a> with <a href="https://github.com/davidkretch" class="external-link">David Kretch</a>.</li>
<li>
<a href="https://github.com/mdneuzerling" class="external-link">David Neuzerling</a>. David‚Äôs <a href="https://github.com/mdneuzerling/lambdr/" class="external-link"><code>lambdr</code></a> package establishes a helpful pattern to submit and collect AWS Lambda jobs from R.</li>
<li>
<a href="https://github.com/MarkEdmondson1234/" class="external-link">Mark Edmondson</a>. Mark maintains several R packages to interface with Google Cloud Platform such as <a href="https://github.com/cloudyr/googleCloudStorageR" class="external-link"><code>googleCloudStorageR</code></a> and <a href="https://github.com/MarkEdmondson1234/googleCloudRunner" class="external-link"><code>googleCloudRunner</code></a>, and he <a href="https://github.com/ropensci/targets/issues/720" class="external-link">started the conversation</a> around helping <a href="https://github.com/ropensci/targets" class="external-link"><code>targets</code></a> submit jobs to Google Cloud Run.</li>
</ul>
</div>
<div class="section level1">
<h1 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h1>
<p>Please note that the <code>crew</code> project is released with a <a href="https://github.com/wlandau/crew/blob/main/CODE_OF_CONDUCT.md" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
<div class="section level1">
<h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>To cite package ‚Äòcrew‚Äô <span class="cf">in</span> publications use<span class="sc">:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  Landau <span class="fu">WM</span> (<span class="dv">2023</span>). _crew<span class="sc">:</span> A Distributed Worker Launcher Framework_.</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  https<span class="sc">:</span><span class="er">//</span>wlandau.github.io<span class="sc">/</span>crew<span class="sc">/</span>, https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>wlandau<span class="sc">/</span>crew.</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>A BibTeX entry <span class="cf">for</span> LaTeX users is</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">@</span>Manual{,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    title <span class="ot">=</span> {crew<span class="sc">:</span> A Distributed Worker Launcher Framework},</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    author <span class="ot">=</span> {William Michael Landau},</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">=</span> {<span class="dv">2023</span>},</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    note <span class="ot">=</span> {https<span class="sc">:</span><span class="er">//</span>wlandau.github.io<span class="sc">/</span>crew<span class="sc">/</span>, https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>wlandau<span class="sc">/</span>crew},</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=crew" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/wlandau/crew/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/wlandau/crew/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing crew</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>William Michael Landau <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1878-3253" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
