<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Specification • crew</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Specification">
<meta property="og:description" content="crew">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">crew</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/specification.html">Specification</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/targets" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="specification_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Specification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wlandau/crew/blob/HEAD/vignettes/specification.Rmd" class="external-link"><code>vignettes/specification.Rmd</code></a></small>
      <div class="hidden name"><code>specification.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wlandau.github.io/crew/" class="external-link">crew</a></span><span class="op">)</span></code></pre></div>
<p>The <code>crew</code> package consists of <code>R6</code> classes. Each object of class <code>crew</code> contains an object of class <code>store</code> and a list of objects of class <code>worker</code>. The <code>crew</code>, <code>store</code>, and <code>worker</code> classes have inheritance hierarchies. Each parent class is an abstract class with a <code>validate()</code> method to ensure the concrete instantiable subclasses define all the required methods and fields. Unless ellipsis (<code>...</code>) is an argument, all formal arguments of subclass methods must be the same as the arguments of the parent class (but default values can be different).</p>
<div class="section level2">
<h2 id="worker">worker<a class="anchor" aria-label="anchor" href="#worker"></a>
</h2>
<p>A <code>worker</code> object encapsulates a worker: a local process, cluster process, or cloud process that accepts and runs work that the crew dispatches.</p>
<p>Required fields:</p>
<ul>
<li>
<code>name</code>: name of the worker.</li>
<li>
<code>crew</code>: the <code>crew</code> object of the crew it belongs to.</li>
<li>
<code>timeout</code>: seconds to idle before the worker times out.</li>
<li>
<code>wait_input</code>: seconds to wait between polling for input (a new job).</li>
<li>
<code>tags</code>: a character vector, optionally containing user-defined tags to identify a subset of eligible heterogeneous workers for submitting and receiving jobs.</li>
<li>
<code>assigned</code>: whether the worker is currently assigned a job.</li>
</ul>
<p>Required methods:</p>
<ul>
<li>
<code>up()</code>: check whether the worker is running.</li>
<li>
<code>launch()</code>: start the worker if it not already running.</li>
<li>
<code>sendable()</code>: whether the worker is available to accept a new job.</li>
<li>
<code>send()</code>: send a job to a worker through the data store and make sure the worker is launched. Errors if the worker is busy (i.e. if <code>sendable()</code> returns <code>FALSE</code>).</li>
<li>
<code>receivable()</code>: whether the worker is done with its current job and is waiting for the crew to read the output data and free the worker to do another job.</li>
<li>
<code>receive()</code>: receive job output from the worker. Assumes the worker is receivable.</li>
<li>
<code>clear()</code>: remove input and output files for the worker.</li>
<li>
<code>shutdown()</code>: send a special job that gracefully shuts down the worker.</li>
<li>
<code>tagged()</code>: check if a worker has one or more tags in a given set.</li>
<li>
<code>validate()</code>: check for errors in the fields and methods.</li>
</ul>
<p>Inheritance hierarchy:</p>
<pre><code>├── worker
│   ├── worker_callr
│   └── worker_future</code></pre>
<p>Instantiable concrete subclasses:</p>
<ul>
<li>
<code>"worker_callr"</code>: worker that runs in a <code><a href="https://callr.r-lib.org/reference/r_bg.html" class="external-link">callr::r_bg()</a></code> process.</li>
<li>
<code>"worker_future"</code>: worker that runs in a <code>future</code>.</li>
</ul>
<p>Other subclasses will run on cloud services like AWS Batch.</p>
</div>
<div class="section level2">
<h2 id="crew">crew<a class="anchor" aria-label="anchor" href="#crew"></a>
</h2>
<p>A <code>crew</code> object manages a group of workers. End users can send jobs and receive output through the <code>crew</code> object directly without having to interface with individual workers.</p>
<p>Required fields:</p>
<ul>
<li>
<code>name</code>: name of the crew object.</li>
<li>
<code>store</code>: data store object.</li>
<li>
<code>worker_classes</code>: list of <code>R6</code> class definitions to construct workers.</li>
<li>
<code>workers</code>: list of worker objects.</li>
</ul>
<p>Methods:</p>
<ul>
<li>
<code>recruit()</code>: create worker objects from one or more worker definitions. Does not actually launch the new worker objects.</li>
<li>
<code>launch()</code>: call the <code>launch()</code> method of each worker. Assumes worker <code>launch()</code> is idempotent so no worker is re-launched if it is already up.</li>
<li>
<code>sendable()</code>: whether any worker is available to accept a new job.</li>
<li>
<code>send()</code>: find an appropriate worker for the job and call its <code>send()</code> method on the job.</li>
<li>
<code>receivable()</code>: whether any worker is done with its current job and is waiting for the crew to read the output data and free the worker to do another job.</li>
<li>
<code>receive()</code>: receive job output from the first detected receivable worker. Assumes there exists a receivable worker in the crew.</li>
<li>
<code>clear()</code>: remove input and output files one or more workers.</li>
<li>
<code>shutdown()</code>: shut down one or more workers. Workers must be sendable if the worker shutdown method uses <code>send()</code>.</li>
<li>
<code>dismiss()</code>: delete one or more worker objects from the crew. Dismissed workers must be down and sendable, so not all requested dismissals actually happen.</li>
<li>
<code>validate()</code>: check for errors in the fields and methods.</li>
</ul>
</div>
<div class="section level2">
<h2 id="store">store<a class="anchor" aria-label="anchor" href="#store"></a>
</h2>
<p>A <code>store</code> object manages files on a file system that the workers and the crew both can access. Files may exist locally or on the cloud, depending on the subclass. The directory structure of a data store has a single root folder and sub-directories <code>input/</code> and <code>output/</code>. The former contains instructions and data for submitted jobs, and the latter contains job output written by the workers. In both cases, there is at most one file per worker, with the base name equal to the worker name. That way, to check if a remote worker completed a job successfully, a worker object can simply check if the <code>output/</code> file exists for the job currently running. (Although a separate backend-specific mechanism is needed in order to detect crashed workers.)</p>
<p>Required fields:</p>
<ul>
<li>
<code>dir_root</code>: directory or prefix of the root of the store file system.</li>
<li>
<code>dir_input</code>: directory or prefix of the input files where jobs are submitted to.</li>
<li>
<code>dir_output</code>: directory or prefix where workers save the output from their jobs.</li>
</ul>
<p>Required methods:</p>
<ul>
<li>
<code>path_input()</code>: return the job input file path of a worker.</li>
<li>
<code>path_output()</code>: return the job output file path of a worker.</li>
<li>
<code>read_input()</code>: read a job’s input file.</li>
<li>
<code>read_output()</code>: read a job’s output file.</li>
<li>
<code>write_input()</code>: write a job’s input file.</li>
<li>
<code>write_output()</code>: write a job’s output file.</li>
<li>
<code>exists_input()</code>: check if a job’s input file exists.</li>
<li>
<code>exists_output()</code>: check if a job’s output file exists.</li>
<li>
<code>delete_input()</code>: delete a job’s input file.</li>
<li>
<code>delete_output()</code>: delete a job’s output file.</li>
<li>
<code>destroy()</code>: delete all the files of the store.</li>
<li>
<code>marshal()</code>: represent the store object as a character string of length 1 for efficient transport to the worker event loop. <code>eval(parse(text = store$marshal()))</code> should reconstruct the store.</li>
<li>
<code>validate()</code>: check for errors in the fields and methods.</li>
</ul>
<p>Inheritance hierarchy:</p>
<pre><code>├── store
│   └── store_local</code></pre>
<p>The <code>"store_local"</code> subclass is the only instantiable sub-class built directly into <code>crew</code>. Other packages that depend on <code>crew</code> will implement other stores that use AWS/GCP buckets instead of local files.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
