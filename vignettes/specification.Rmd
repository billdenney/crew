---
title: "Specification"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{Specification}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(crew)
```

This vignette is a specification of the classes in `crew`. Sub-classes are listed, but only the ones implemented in the `crew` package itself. Other sub-classes may be developed in packages that depend on `crew`.

# crew

A `crew` represents a group of workers. It contains:

* Its name.
* A `store` object with a data store to send and receive worker data.
* A list of worker objects to manage active workers
* A worker definition to launch new workers.

A crew is in charge of

* Launching new workers.
* Assigning jobs to workers.
* Polling workers.
* Receiving and processing data from workers.
* Terminating workers.

# worker

A `worker` object encapsulates a worker: a local process, cluster process, or cloud process that accepts and runs work that the crew dispatches. It contains:

* Its name.
* The `crew` object of the crew it belongs to.

## Sequential worker

Worker that runs in a simple R process.

## Future worker

Worker that runs in a `future`.

# store

A `store` object manages files on a file system that the workers and the crew both can access. The store object contains:

* Paths to directories and sub-directories.
* Methods to read, write, check the existence of, and delete worker files.

Files may exist locally or on the cloud, depending on the subclass. The directory structure of a data store has a single root folder and sub-directories `inpu/` and `output/`. The former contains instructions and data for submitted jobs, and the latter contains job output written by the workers. In both cases, there is one file per job, and the file names are in alphabetical order according to the file system. Benefits of this design include:

* Polling by design: to poll, a worker object can simply check if the `output/` file exists for the job currently running. (Although a separate mechanism is needed in order to detect crashed workers.)
* A natural first-in-first-out queue for job submission dictated solely by the file names.

## Local store

Subclass of a store based on local files.

## AWS S3 store

Subclass of a store based on AWS S3

## Google Cloud store

Subclass of a store based on Google Cloud Storage.

